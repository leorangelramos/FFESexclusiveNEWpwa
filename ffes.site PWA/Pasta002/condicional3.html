<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FFES | Third Conditional</title>
    <link rel="stylesheet" href="../style.css">
    <style>
        /* === ESTILO UNIFICADO (PADRÃO PWA - SOBERANIA) === */
        
        /* Layout Principal */
        .game-wrapper {
            width: 100%;
            max-width: 600px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            z-index: 10;
            margin: 0 auto;
        }

        /* Card do Jogo */
        .game-card {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border: 2px solid var(--accent-gold);
            border-radius: 24px;
            padding: 30px 20px;
            text-align: center;
            box-shadow: var(--glass-shadow);
            min-height: 180px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        /* Tipografia */
        #display-sentence {
            font-size: 1.5rem; /* Levemente menor para frases longas */
            font-weight: 700;
            line-height: 1.4;
            color: var(--text-white);
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
            z-index: 2;
        }

        /* Lacunas */
        .gap { 
            color: var(--accent-gold); 
            border-bottom: 3px solid var(--accent-gold); 
            padding: 0 8px; 
            display: inline-block; 
            min-width: 60px; 
        }

        /* Feedback Visual */
        #feedback {
            height: 30px;
            text-align: center;
            font-weight: 800;
            letter-spacing: 2px;
            text-transform: uppercase;
            transition: all 0.2s;
            opacity: 0;
            margin-bottom: 10px;
        }
        #feedback.visible { opacity: 1; transform: translateY(-5px); }

        /* Controles */
        .game-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            width: 100%;
        }

        .btn-option {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            color: var(--text-white);
            padding: 20px;
            font-size: 1.1rem; /* Ajuste para caber 'would have' */
            font-weight: 800;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            backdrop-filter: var(--glass-blur);
            text-transform: capitalize;
        }

        .btn-option:hover {
            border-color: var(--accent-gold);
            background: rgba(255, 184, 28, 0.1);
            transform: translateY(-3px);
        }

        .btn-option.correct {
            background: #00e676 !important;
            color: #000 !important;
            border-color: #00e676 !important;
        }

        .btn-option.wrong {
            background: #ff1744 !important;
            opacity: 0.5;
        }

        /* XP Pill */
        .xp-pill {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--accent-gold);
            padding: 5px 15px;
            border-radius: 50px;
            color: var(--accent-gold);
            font-weight: 800;
            font-size: 1.1rem;
            margin-top: 10px;
            display: inline-block;
        }

        /* Teoria */
        .theory-section { 
            background: rgba(255, 255, 255, 0.05); 
            backdrop-filter: blur(10px); 
            border: 1px solid rgba(255, 255, 255, 0.1); 
            border-radius: 20px; 
            padding: 2rem; 
            margin-bottom: 30px; 
            color: var(--text-white); 
        }
        
        .formula-box { 
            background: rgba(184, 134, 11, 0.1); 
            border-left: 4px solid var(--accent-gold); 
            padding: 15px; 
            margin: 20px 0; 
            border-radius: 0 10px 10px 0; 
            font-weight: bold; 
        }

        .text-gold { color: var(--accent-gold); }

        /* === ANIMAÇÃO 1: EXPLOSÃO CENTRAL (A cada acerto) === */
        .casino-coin {
            position: fixed;
            width: 25px; height: 25px;
            background: var(--accent-gold);
            border-radius: 50%;
            box-shadow: 0 0 12px rgba(255, 215, 0, 1);
            pointer-events: none; z-index: 9999;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            border: 2px solid #fff;
        }

        @keyframes coin-explosion {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(1.2) rotate(360deg); opacity: 0; }
        }

        /* === ANIMAÇÃO 2: CHUVA (Combos x10) === */
        .rain-coin {
            position: fixed;
            width: 30px; height: 30px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="%23FFD700" stroke="%23B8860B" stroke-width="5"/><text x="50" y="65" font-size="40" text-anchor="middle" fill="%23B8860B" font-family="Arial">$</text></svg>') no-repeat center;
            background-size: contain;
            pointer-events: none; z-index: 9999;
            top: -50px;
            animation: coin-drop linear forwards;
        }

        @keyframes coin-drop {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(110vh) rotate(360deg); opacity: 0.8; }
        }

        /* Engenharia de Interface */
        .progress-track {
            width: 100%; height: 5px;
            background: rgba(255,255,255,0.1);
            position: fixed; top: 0; left: 0; z-index: 1000;
        }
        .progress-fill {
            height: 100%; background: var(--accent-gold);
            width: 0%; transition: width 0.3s ease;
            box-shadow: 0 0 10px var(--accent-gold);
        }

        .feedback-float {
            position: absolute; top: -15px; right: -10px;
            font-weight: 900; font-size: 0.9rem;
            color: var(--accent-gold); background: rgba(0,0,0,0.8);
            padding: 5px 12px; border-radius: 20px; border: 1px solid var(--accent-gold);
            opacity: 0; transform: translateY(10px);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 5;
        }
        .feedback-float.show { opacity: 1; transform: translateY(0) rotate(5deg); }

        .speed-badge {
            position: absolute; bottom: 10px; width: 100%; left: 0;
            text-align: center; font-size: 0.7rem; color: #00e676;
            font-weight: 800; letter-spacing: 1px; text-transform: uppercase;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-6px); }
            40%, 80% { transform: translateX(6px); }
        }
        .shake-effect { animation: shake 0.4s ease-in-out; }

    </style>
</head>
<body>
    <div class="background-glow glow-1"></div>
    
    <div class="progress-track"><div class="progress-fill" id="progress-bar"></div></div>

    <header class="glass-header">
        <h1>THIRD <span class="text-gold">CONDITIONAL</span></h1>
        <p class="subtitle">Módulo 04: O Passado Impossível</p>
        <div class="xp-pill">XP: <span id="xp-val">0</span></div>
    </header>

    <main style="max-width: 800px; margin: 0 auto; padding: 20px;">
        
        <section class="theory-section">
            <h2 class="text-gold">Se eu tivesse... Teria...</h2>
            <p>Usado para imaginar um passado diferente. Arrependimentos ou hipóteses.</p>
            
            <div class="formula-box" style="font-size: 0.9rem;">IF + HAD + PARTICÍPIO ... WOULD HAVE + PARTICÍPIO</div>
            
            <ul style="margin-left: 20px; opacity: 0.9;">
                <li><strong>Lado do IF:</strong> HAD + Verbo (3ª coluna).</li>
                <li><strong>Lado do Resultado:</strong> WOULD HAVE + Verbo (3ª coluna).</li>
                <li><strong>Exemplo:</strong> If I <strong>had gone</strong>, I <strong>would have seen</strong> her.</li>
            </ul>
        </section>

        <div id="game-container" class="game-wrapper">
            <div id="feedback"></div>

            <div class="game-card" id="game-card-element">
                <div id="combo-feedback" class="feedback-float">COMBO x2</div>
                <div id="speed-feedback" class="speed-badge"></div>

                <div id="display-sentence">Prepare-se...</div>
            </div>

            <div class="game-controls" id="ab-controls">
                <button id="btn1" class="btn-option" onclick="checkAnswer(1)">A</button>
                <button id="btn2" class="btn-option" onclick="checkAnswer(2)">B</button>
            </div>
        </div>
    </main>

    <footer class="glass-footer">
        © 2026 FFES - Sovereignty System v2.5
    </footer>

    <script>
        // === BANCO DE DADOS (THIRD CONDITIONAL) ===
        // Estrutura: IF + HAD + PP ... WOULD HAVE + PP
        // Foco: Frases simples e mecanicas.
        
        const scenarios = [
            // Testando o Resultado (WOULD HAVE)
            { ifPart: "If I had known", resPart: "I ___ gone.", correct: "would have", wrong: "will have" },
            { ifPart: "If she had studied", resPart: "she ___ passed.", correct: "would have", wrong: "would has" }, // Would has não existe
            { ifPart: "If we had played", resPart: "we ___ won.", correct: "would have", wrong: "had" },
            { ifPart: "If it had rained", resPart: "I ___ stayed.", correct: "would have", wrong: "will have" },
            { ifPart: "If you had called", resPart: "I ___ answered.", correct: "would have", wrong: "would had" },
            
            // Testando o IF (HAD)
            { ifPart: "If I ___ gone", resPart: "I would have seen it.", correct: "had", wrong: "have" },
            { ifPart: "If she ___ known", resPart: "she would have said yes.", correct: "had", wrong: "has" },
            { ifPart: "If they ___ arrived", resPart: "we would have eaten.", correct: "had", wrong: "would" },
            { ifPart: "If I ___ tried", resPart: "I would have succeeded.", correct: "had", wrong: "have" },
            { ifPart: "If he ___ listened", resPart: "he would have learned.", correct: "had", wrong: "has" }
        ];

        let database = [];

        function buildDatabase() {
            database = [];
            for(let i=0; i<300; i++) {
                const item = scenarios[Math.floor(Math.random() * scenarios.length)];
                
                let sentence = "";
                // Construção dinâmica da frase
                if (item.ifPart.includes("___")) {
                    // Lacuna no IF (Teste de HAD)
                    sentence = `${item.ifPart.replace('___', '<span class="gap">_____</span>')}, ${item.resPart}`;
                } else {
                    // Lacuna no Resultado (Teste de WOULD HAVE)
                    sentence = `${item.ifPart}, ${item.resPart.replace('___', '<span class="gap">_____</span>')}`;
                }

                database.push({
                    en: sentence,
                    correct: item.correct,
                    wrong: item.wrong
                });
            }
        }
        buildDatabase();

        // === ENGINE (PADRÃO SOBERANIA) ===
        let xp = parseInt(localStorage.getItem('ffes_xp') || 0);
        document.getElementById('xp-val').innerText = xp;
        
        let state = { currentQ: null, combo: 0, startTime: 0 };
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function startGame() {
            document.getElementById('game-container').style.display = 'flex';
            generate();
        }

        function generate() {
            document.querySelectorAll('.btn-option').forEach(b => b.className = 'btn-option');
            document.getElementById('feedback').className = ''; 
            document.getElementById('feedback').innerText = '';
            document.getElementById('speed-feedback').innerText = "";

            const item = database[Math.floor(Math.random() * database.length)];
            state.currentQ = item;
            state.startTime = Date.now();

            const display = document.getElementById('display-sentence');
            display.innerHTML = item.en;

            if(Math.random() > 0.5) {
                setOptions(item.correct, item.wrong, item.correct);
            } else {
                setOptions(item.wrong, item.correct, item.correct);
            }
        }

        function setOptions(txt1, txt2, correctVal) {
            const btn1 = document.getElementById('btn1');
            const btn2 = document.getElementById('btn2');
            btn1.innerText = txt1; 
            btn1.onclick = () => checkAnswer(txt1 === correctVal, btn1);
            btn2.innerText = txt2; 
            btn2.onclick = () => checkAnswer(txt2 === correctVal, btn2);
        }

        function checkAnswer(isCorrect, element) {
            const fb = document.getElementById('feedback');
            const timeDelta = Date.now() - state.startTime;
            const isSpeed = timeDelta < 2500; 

            if (isCorrect) {
                state.combo++;
                let xpGain = 10 + (state.combo * 2);
                if(isSpeed) xpGain += 5;
                addXP(xpGain);
                
                fb.innerText = "IMPECÁVEL!"; fb.style.color = "#00e676"; fb.className = "visible";
                element.classList.add('correct');
                
                triggerCasinoEffect(12);

                if (state.combo % 10 === 0) {
                    playAudio('milestone'); 
                    triggerCoinRain(40); 
                } else if (state.combo > 1) {
                    playAudio('combo');
                } else {
                    playAudio('win');
                }
                
                if(isSpeed) document.getElementById('speed-feedback').innerText = "⚡ HACKER SPEED!";

                const comboEl = document.getElementById('combo-feedback');
                comboEl.innerText = `COMBO x${state.combo}`;
                comboEl.classList.add('show');

                let w = parseFloat(document.getElementById('progress-bar').style.width || 0);
                document.getElementById('progress-bar').style.width = (w + 5) % 100 + '%';

                setTimeout(() => {
                    comboEl.classList.remove('show');
                    generate();
                }, 1500);

            } else {
                state.combo = 0;
                addXP(-5);
                fb.innerText = "CORREÇÃO: " + state.currentQ.correct.toUpperCase();
                fb.style.fontSize = "0.9rem";
                fb.style.color = "#ff1744"; fb.className = "visible";
                element.classList.add('wrong');
                playAudio('error');
                
                const card = document.getElementById('game-card-element');
                card.classList.add('shake-effect');
                setTimeout(() => card.classList.remove('shake-effect'), 400);
                document.getElementById('combo-feedback').classList.remove('show');
            }
        }

        function addXP(val) {
            xp = Math.max(0, xp + val); 
            localStorage.setItem('ffes_xp', xp);
            document.getElementById('xp-val').innerText = xp;
        }

        // === AUDIO E EFEITOS ===
        function playAudio(type) {
            if (audioCtx.state === 'suspended') { audioCtx.resume(); }
            const t = audioCtx.currentTime;
            
            if(type === 'milestone') {
                const frequencies = [523.25, 659.25, 783.99, 1046.50, 1318.5]; 
                frequencies.forEach((f, i) => {
                    const osc = audioCtx.createOscillator();
                    const gain = audioCtx.createGain();
                    osc.type = 'triangle'; 
                    osc.frequency.setValueAtTime(f, t + (i * 0.08)); 
                    gain.gain.setValueAtTime(0.1, t + (i * 0.08));
                    gain.gain.exponentialRampToValueAtTime(0.01, t + (i * 0.08) + 0.8);
                    osc.connect(gain);
                    gain.connect(audioCtx.destination);
                    osc.start(t + (i * 0.08));
                    osc.stop(t + (i * 0.08) + 0.8);
                });
            } else if(type === 'combo') {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.type = 'square'; 
                const baseFreq = Math.min(300 + (state.combo * 50), 1000);
                osc.frequency.setValueAtTime(baseFreq, t);
                osc.frequency.linearRampToValueAtTime(baseFreq + 200, t + 0.15); 
                gain.gain.setValueAtTime(0.05, t);
                gain.gain.exponentialRampToValueAtTime(0.01, t + 0.2);
                osc.start(t); osc.stop(t + 0.2);
            } else if(type === 'win') {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.type = 'sine';
                osc.frequency.setValueAtTime(800, t);
                gain.gain.setValueAtTime(0.05, t);
                gain.gain.exponentialRampToValueAtTime(0.01, t + 0.15);
                osc.start(t); osc.stop(t + 0.15);
            } else if(type === 'error') {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, t);
                osc.frequency.linearRampToValueAtTime(100, t + 0.2);
                gain.gain.exponentialRampToValueAtTime(0.01, t + 0.3);
                osc.start(t); osc.stop(t + 0.3);
            }
        }

        // Explosão Central
        function triggerCasinoEffect(amount = 12) {
            for (let i = 0; i < amount; i++) {
                const coin = document.createElement('div');
                coin.classList.add('casino-coin');
                const angle = Math.random() * Math.PI * 2;
                const distance = 80 + Math.random() * 120; 
                coin.style.setProperty('--tx', Math.cos(angle) * distance + 'px');
                coin.style.setProperty('--ty', Math.sin(angle) * distance + 'px');
                coin.style.animation = `coin-explosion ${0.6 + Math.random() * 0.4}s ease-out forwards`;
                document.body.appendChild(coin);
                setTimeout(() => { coin.remove(); }, 1200);
            }
        }

        // Chuva (Jackpot)
        function triggerCoinRain(amount = 50) {
            for (let i = 0; i < amount; i++) {
                const coin = document.createElement('div');
                coin.classList.add('rain-coin');
                coin.style.left = Math.random() * 100 + 'vw';
                coin.style.animationDuration = (1.5 + Math.random() * 1.5) + 's';
                coin.style.animationDelay = (Math.random() * 1.0) + 's';
                document.body.appendChild(coin);
                setTimeout(() => { coin.remove(); }, 3000);
            }
        }

        window.onload = startGame;
    </script>
</body>
</html>